<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AGF/AGV èƒ½åŠ›è¨ˆç®—ãƒ„ãƒ¼ãƒ«</title>
    <style>
        /* ====== Linear Design System ====== */
        :root {
            --bg-primary: #ffffff;
            --bg-secondary: #f8f8fa;
            --bg-tertiary: #f0f0f3;
            --bg-card: #ffffff;
            --bg-input: #f5f5f7;
            --bg-hover: #e8e8ee;
            --border: #d1d1d8;
            --border-focus: #5e6ad2;
            --text-primary: #1a1a1a;
            --text-secondary: #6b6b7a;
            --text-tertiary: #9a9aae;
            --accent: #5e6ad2;
            --accent-hover: #4850b8;
            --accent-subtle: rgba(94, 106, 210, 0.08);
            --success: #2da770;
            --success-subtle: rgba(45, 167, 112, 0.08);
            --warning: #d4900a;
            --warning-subtle: rgba(212, 144, 10, 0.08);
            --danger: #cd2b31;
            --danger-subtle: rgba(205, 43, 49, 0.08);
            --radius-sm: 6px;
            --radius-md: 8px;
            --radius-lg: 12px;
            --shadow: 0 1px 3px rgba(0,0,0,0.08), 0 1px 2px rgba(0,0,0,0.04);
            --shadow-lg: 0 4px 12px rgba(0,0,0,0.1);
            --transition: 150ms cubic-bezier(0.4, 0, 0.2, 1);
            --font: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
        }

        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: var(--font);
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
            min-height: 100vh;
        }

        /* ====== Header ====== */
        .header {
            position: sticky;
            top: 0;
            z-index: 100;
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-bottom: 1px solid var(--border);
            padding: 0 24px;
        }
        .header-inner {
            max-width: 1280px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
            height: 56px;
        }
        .header-logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 600;
            font-size: 15px;
            letter-spacing: -0.3px;
        }
        .header-logo svg {
            width: 22px;
            height: 22px;
            fill: var(--accent);
        }
        .header-badge {
            font-size: 11px;
            font-weight: 500;
            background: var(--accent-subtle);
            color: var(--accent);
            padding: 2px 8px;
            border-radius: 999px;
            letter-spacing: 0.3px;
        }

        /* ====== Tab Navigation ====== */
        .tab-nav {
            display: flex;
            gap: 2px;
            background: var(--bg-tertiary);
            padding: 3px;
            border-radius: var(--radius-md);
            width: fit-content;
        }
        .tab-btn {
            padding: 6px 16px;
            font-size: 13px;
            font-weight: 500;
            border: none;
            background: transparent;
            color: var(--text-secondary);
            cursor: pointer;
            border-radius: var(--radius-sm);
            transition: all var(--transition);
            white-space: nowrap;
        }
        .tab-btn:hover { color: var(--text-primary); }
        .tab-btn.active {
            background: var(--bg-card);
            color: var(--text-primary);
            box-shadow: 0 1px 2px rgba(0,0,0,0.2);
        }

        /* ====== Layout ====== */
        .container {
            max-width: 1280px;
            margin: 0 auto;
            padding: 24px;
        }
        .page-title {
            font-size: 22px;
            font-weight: 600;
            letter-spacing: -0.5px;
            margin-bottom: 4px;
        }
        .page-subtitle {
            font-size: 13px;
            color: var(--text-secondary);
            margin-bottom: 24px;
        }

        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        .grid-full { grid-column: 1 / -1; }

        @media (max-width: 900px) {
            .grid { grid-template-columns: 1fr; }
        }

        /* ====== Card ====== */
        .card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            overflow: hidden;
        }
        .card-header {
            padding: 14px 18px;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .card-header-icon {
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: var(--radius-sm);
            font-size: 12px;
        }
        .card-header-icon.blue { background: var(--accent-subtle); color: var(--accent); }
        .card-header-icon.green { background: var(--success-subtle); color: var(--success); }
        .card-header-icon.orange { background: var(--warning-subtle); color: var(--warning); }
        .card-header-icon.red { background: var(--danger-subtle); color: var(--danger); }

        .card-title {
            font-size: 13px;
            font-weight: 600;
            letter-spacing: -0.2px;
        }
        .card-body {
            padding: 16px 18px;
        }

        /* ====== Form Elements ====== */
        .form-group {
            margin-bottom: 14px;
        }
        .form-group:last-child { margin-bottom: 0; }

        .form-label {
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-size: 12px;
            font-weight: 500;
            color: var(--text-secondary);
            margin-bottom: 5px;
        }
        .form-unit {
            font-size: 11px;
            color: var(--text-tertiary);
            font-weight: 400;
        }

        .form-input {
            width: 100%;
            padding: 8px 12px;
            background: var(--bg-input);
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            color: var(--text-primary);
            font-size: 13px;
            font-family: var(--font);
            transition: border-color var(--transition);
            outline: none;
        }
        .form-input:hover { border-color: #3a3a48; }
        .form-input:focus { border-color: var(--border-focus); box-shadow: 0 0 0 1px var(--border-focus); }
        .form-input::placeholder { color: var(--text-tertiary); }

        .form-input-sm {
            padding: 6px 10px;
            font-size: 12px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }
        .form-row-3 {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 12px;
        }

        /* ====== Result Display ====== */
        .result-grid {
            display: grid;
            gap: 1px;
            background: var(--border);
            border-radius: var(--radius-md);
            overflow: hidden;
        }
        .result-item {
            background: var(--bg-card);
            padding: 12px 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .result-label {
            font-size: 12px;
            color: var(--text-secondary);
        }
        .result-value {
            font-size: 14px;
            font-weight: 600;
            font-variant-numeric: tabular-nums;
        }
        .result-value.highlight {
            color: var(--accent);
            font-size: 18px;
        }
        .result-value.success { color: var(--success); }
        .result-value.warning { color: var(--warning); }

        .result-unit {
            font-size: 11px;
            color: var(--text-tertiary);
            margin-left: 4px;
            font-weight: 400;
        }

        /* ====== Big Number Display ====== */
        .big-number-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
        }
        .big-number {
            text-align: center;
            padding: 16px 12px;
            background: var(--bg-tertiary);
            border-radius: var(--radius-md);
            border: 1px solid var(--border);
        }
        .big-number-label {
            font-size: 11px;
            color: var(--text-secondary);
            margin-bottom: 4px;
            font-weight: 500;
        }
        .big-number-value {
            font-size: 28px;
            font-weight: 700;
            letter-spacing: -1px;
            font-variant-numeric: tabular-nums;
        }
        .big-number-unit {
            font-size: 12px;
            color: var(--text-tertiary);
            margin-top: 2px;
        }
        .big-number.primary .big-number-value { color: var(--accent); }
        .big-number.success .big-number-value { color: var(--success); }
        .big-number.warning .big-number-value { color: var(--warning); }

        /* ====== Route Builder ====== */
        .route-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        .route-item {
            display: grid;
            grid-template-columns: auto 1fr auto auto auto;
            gap: 8px;
            align-items: center;
            padding: 8px 12px;
            background: var(--bg-tertiary);
            border-radius: var(--radius-sm);
            border: 1px solid var(--border);
        }
        .route-badge {
            font-size: 10px;
            font-weight: 600;
            padding: 2px 8px;
            border-radius: 999px;
            background: var(--accent-subtle);
            color: var(--accent);
            white-space: nowrap;
        }
        .route-name {
            font-size: 13px;
            font-weight: 500;
        }
        .route-input {
            width: 80px;
        }
        .route-btn-remove {
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: transparent;
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            color: var(--text-tertiary);
            cursor: pointer;
            font-size: 14px;
            transition: all var(--transition);
        }
        .route-btn-remove:hover {
            background: var(--danger-subtle);
            border-color: var(--danger);
            color: var(--danger);
        }

        .btn {
            padding: 7px 14px;
            font-size: 12px;
            font-weight: 500;
            font-family: var(--font);
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: all var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }
        .btn-ghost {
            background: transparent;
            color: var(--text-secondary);
        }
        .btn-ghost:hover {
            background: var(--bg-hover);
            color: var(--text-primary);
        }
        .btn-primary {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
        }
        .btn-primary:hover {
            background: var(--accent-hover);
        }

        /* ====== Segment / Curve Input ====== */
        .segment-list {
            display: flex;
            flex-direction: column;
            gap: 6px;
            max-height: 250px;
            overflow-y: auto;
        }
        .segment-item {
            display: grid;
            grid-template-columns: auto 1fr auto auto;
            gap: 8px;
            align-items: center;
            padding: 6px 10px;
            background: var(--bg-input);
            border-radius: var(--radius-sm);
            border: 1px solid var(--border);
            font-size: 12px;
        }
        .segment-type {
            font-size: 10px;
            font-weight: 600;
            padding: 2px 6px;
            border-radius: 999px;
            white-space: nowrap;
        }
        .segment-type.straight {
            background: var(--success-subtle);
            color: var(--success);
        }
        .segment-type.curve {
            background: var(--warning-subtle);
            color: var(--warning);
        }

        /* ====== Reference Table ====== */
        .ref-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 12px;
        }
        .ref-table th {
            padding: 8px 12px;
            text-align: left;
            font-weight: 500;
            color: var(--text-secondary);
            border-bottom: 1px solid var(--border);
        }
        .ref-table td {
            padding: 8px 12px;
            border-bottom: 1px solid var(--border);
        }
        .ref-table tr:last-child td { border-bottom: none; }
        .ref-table tr:hover td { background: var(--bg-hover); }

        /* ====== Tooltip ====== */
        .tooltip {
            position: relative;
            cursor: help;
        }
        .tooltip::after {
            content: attr(data-tip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: var(--bg-tertiary);
            color: var(--text-primary);
            padding: 6px 10px;
            border-radius: var(--radius-sm);
            font-size: 11px;
            white-space: nowrap;
            border: 1px solid var(--border);
            pointer-events: none;
            opacity: 0;
            transition: opacity var(--transition);
            z-index: 10;
        }
        .tooltip:hover::after { opacity: 1; }

        /* ====== Separator ====== */
        .separator {
            height: 1px;
            background: var(--border);
            margin: 16px 0;
        }

        /* ====== Scrollbar ====== */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--text-tertiary); }

        /* ====== Utilities ====== */
        .hidden { display: none !important; }
        .mt-8 { margin-top: 8px; }
        .mt-12 { margin-top: 12px; }
        .mt-16 { margin-top: 16px; }
        .mt-24 { margin-top: 24px; }
        .mb-8 { margin-bottom: 8px; }
        .text-xs { font-size: 11px; }
        .text-muted { color: var(--text-secondary); }

        /* ====== Info Banner ====== */
        .info-banner {
            padding: 10px 14px;
            border-radius: var(--radius-sm);
            font-size: 12px;
            line-height: 1.5;
            display: flex;
            align-items: flex-start;
            gap: 8px;
        }
        .info-banner.info {
            background: var(--accent-subtle);
            color: var(--accent);
            border: 1px solid rgba(94, 106, 210, 0.2);
        }
        .info-banner.warn {
            background: var(--warning-subtle);
            color: var(--warning);
            border: 1px solid rgba(245, 166, 35, 0.2);
        }

        /* ====== Print ====== */
        @media print {
            body { background: white; color: #111; }
            .header { position: static; background: white; border-bottom: 2px solid #ddd; }
            .card { border-color: #ddd; page-break-inside: avoid; }
            .form-input { border-color: #ccc; background: #f9f9f9; }
            .tab-nav { display: none; }
        }
    </style>
</head>
<body>

<!-- Header -->
<header class="header">
    <div class="header-inner">
        <div class="header-logo">
            <svg viewBox="0 0 24 24"><path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/></svg>
            èƒ½åŠ›è¨ˆç®—ãƒ„ãƒ¼ãƒ«
            <span class="header-badge">v1.0</span>
        </div>
        <div class="tab-nav">
            <button class="tab-btn active" onclick="switchMode('agf')">AGFï¼ˆãƒ•ã‚©ãƒ¼ã‚¯ãƒªãƒ•ãƒˆï¼‰</button>
            <button class="tab-btn" onclick="switchMode('agv')">AGVï¼ˆæ¬é€è»Šï¼‰</button>
        </div>
    </div>
</header>

<div class="container">
    <h1 class="page-title" id="pageTitle">AGF èƒ½åŠ›è¨ˆç®—ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼</h1>
    <p class="page-subtitle">æ¬é€æ¡ä»¶ã‚’å…¥åŠ›ã™ã‚‹ã ã‘ã§ã€å¿…è¦å°æ•°ã‚’ã™ãã«ç®—å‡ºã§ãã¾ã™ã€‚</p>

    <div class="grid">
        <!-- ===== å·¦ã‚«ãƒ©ãƒ : å…¥åŠ› ===== -->
        <div>
            <!-- åŸºæœ¬æ¬é€æ¡ä»¶ -->
            <div class="card mb-8">
                <div class="card-header">
                    <div class="card-header-icon blue">â—†</div>
                    <span class="card-title">åŸºæœ¬æ¬é€æ¡ä»¶</span>
                </div>
                <div class="card-body">
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">ç‰‡é“è·é›¢ <span class="form-unit">m</span></label>
                            <input type="number" class="form-input" id="oneWayDist" value="50" min="1" step="1" oninput="calculate()">
                        </div>
                        <div class="form-group">
                            <label class="form-label">å¾€å¾©è·é›¢ <span class="form-unit">mï¼ˆè‡ªå‹•è¨ˆç®—ï¼‰</span></label>
                            <input type="number" class="form-input" id="roundTripDist" value="100" readonly style="opacity:0.6">
                        </div>
                    </div>
                    <!-- æ¬é€å›æ•°å…¥åŠ›ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿ -->
                    <div class="form-group">
                        <label class="form-label">æ¬é€å›æ•°ã®å…¥åŠ›æ–¹å¼</label>
                        <div class="tab-nav" style="width:100%;">
                            <button class="tab-btn active" id="tripModeAuto" onclick="setTripMode('auto')" style="flex:1;text-align:center;">è‡ªå‹•è¨ˆç®—ï¼ˆæ—¥æ¬¡â†’æ™‚é–“æ›ç®—ï¼‰</button>
                            <button class="tab-btn" id="tripModeManual" onclick="setTripMode('manual')" style="flex:1;text-align:center;">æ‰‹å‹•å…¥åŠ›ï¼ˆæ™‚é–“ã‚ãŸã‚Šç›´æ¥ï¼‰</button>
                        </div>
                    </div>
                    <div id="tripAutoSection">
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">ç¨¼åƒæ™‚é–“ <span class="form-unit">h/æ—¥</span></label>
                                <input type="number" class="form-input" id="opHours" value="13" min="1" step="0.5" oninput="calculate()">
                            </div>
                            <div class="form-group">
                                <label class="form-label">1æ—¥ã®æ¬é€å›æ•° <span class="form-unit">å›/æ—¥</span></label>
                                <input type="number" class="form-input" id="dailyTrips" value="100" min="1" step="1" oninput="calculate()">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">1æ™‚é–“ã‚ãŸã‚Šã®æ¬é€å›æ•° <span class="form-unit">å›/hï¼ˆè‡ªå‹•è¨ˆç®—ï¼‰</span></label>
                            <input type="number" class="form-input" id="hourlyTrips" value="" readonly style="opacity:0.6">
                        </div>
                    </div>
                    <div id="tripManualSection" class="hidden">
                        <div class="form-group">
                            <label class="form-label">1æ™‚é–“ã‚ãŸã‚Šã®æ¬é€å›æ•° <span class="form-unit">å›/hï¼ˆæ‰‹å‹•å…¥åŠ›ï¼‰</span></label>
                            <input type="number" class="form-input" id="hourlyTripsManual" value="10" min="0.1" step="0.1" oninput="calculate()" placeholder="ä¾‹: 10">
                        </div>
                    </div>
                </div>
            </div>

            <!-- ãƒ­ãƒœãƒƒãƒˆã‚¹ãƒšãƒƒã‚¯ -->
            <div class="card mb-8" style="margin-top:16px;">
                <div class="card-header">
                    <div class="card-header-icon blue">â– </div>
                    <span class="card-title" id="specTitle">AGF ã‚¹ãƒšãƒƒã‚¯ãƒ»èµ°è¡Œæ¡ä»¶</span>
                </div>
                <div class="card-body">
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">ã‚«ã‚¿ãƒ­ã‚°æœ€é«˜é€Ÿåº¦ <span class="form-unit">km/h</span></label>
                            <input type="number" class="form-input" id="catalogSpeed" value="5" min="0.1" step="0.1" oninput="calculate()">
                        </div>
                        <div class="form-group">
                            <label class="form-label tooltip" data-tip="å®Ÿé‹ç”¨ã§ã®ã‚«ã‚¿ãƒ­ã‚°å€¤ã«å¯¾ã™ã‚‹æ¯”ç‡ï¼ˆ0.7ã€œ1.0ï¼‰">å®Ÿé‹ç”¨ä¿‚æ•° <span class="form-unit">ï¼ˆ0ã€œ1.0ï¼‰</span></label>
                            <input type="number" class="form-input" id="opCoeff" value="0.8" min="0.1" max="1.0" step="0.05" oninput="calculate()">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">ç‰‡é“åœæ­¢å›æ•° <span class="form-unit">å›</span></label>
                            <input type="number" class="form-input" id="stopCount" value="2" min="0" step="1" oninput="calculate()">
                        </div>
                        <div class="form-group">
                            <label class="form-label tooltip" data-tip="æ¸›é€Ÿï¼‹åœæ­¢ï¼‹å†åŠ é€Ÿã‚’å«ã‚€">1å›ã‚ãŸã‚Šåœæ­¢ãƒ­ã‚¹ <span class="form-unit">ç§’</span></label>
                            <input type="number" class="form-input" id="stopLoss" value="15" min="0" step="1" oninput="calculate()">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label tooltip" data-tip="ç›®å®‰: äººå°‘ãªã‚10ã€œ15% / äººå…±å­˜20ã€œ30% / æ··é›‘å¤šã„30ã€œ40%">å¾è¡Œãƒ»æ¸›é€Ÿãƒ­ã‚¹ç‡ <span class="form-unit">%</span></label>
                        <input type="number" class="form-input" id="slowdownRate" value="25" min="0" max="100" step="1" oninput="calculate()">
                        <div class="info-banner info mt-8">
                            <span>ğŸ’¡</span>
                            <span>äººå°‘ãªã‚: 10ã€œ15% ï¼ äººå…±å­˜: 20ã€œ30% ï¼ æ··é›‘å¤šã„: 30ã€œ40%<br>ææ¡ˆåˆæœŸ: 25% ï¼ å®‰å…¨å´: 30ã€œ35%</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- AGFå°‚ç”¨: ãƒªãƒ•ãƒˆå‹•ä½œ -->
            <div class="card mb-8" id="liftSection" style="margin-top:16px;">
                <div class="card-header">
                    <div class="card-header-icon orange">â¬†</div>
                    <span class="card-title">ãƒªãƒ•ãƒˆå‹•ä½œï¼ˆAGFå°‚ç”¨ï¼‰</span>
                </div>
                <div class="card-body">
                    <div class="form-row-3">
                        <div class="form-group">
                            <label class="form-label">ä¸Šæ˜‡æ™‚é–“ <span class="form-unit">ç§’/å›</span></label>
                            <input type="number" class="form-input" id="liftUp" value="30" min="0" step="1" oninput="calculate()">
                        </div>
                        <div class="form-group">
                            <label class="form-label">ä¸‹é™æ™‚é–“ <span class="form-unit">ç§’/å›</span></label>
                            <input type="number" class="form-input" id="liftDown" value="30" min="0" step="1" oninput="calculate()">
                        </div>
                        <div class="form-group">
                            <label class="form-label">å¾€å¾©å‹•ä½œå›æ•° <span class="form-unit">set</span></label>
                            <input type="number" class="form-input" id="liftCycles" value="1" min="0" step="1" oninput="calculate()">
                        </div>
                    </div>
                </div>
            </div>

            <!-- èµ°è¡ŒçµŒè·¯è©³ç´° -->
            <div class="card" style="margin-top:16px;">
                <div class="card-header">
                    <div class="card-header-icon green">ğŸ›¤</div>
                    <span class="card-title">èµ°è¡ŒçµŒè·¯è©³ç´°ï¼ˆç›´é€²ãƒ»ã‚«ãƒ¼ãƒ–ï¼‰</span>
                </div>
                <div class="card-body">
                    <div class="info-banner warn mb-8">
                        <span>âš ï¸</span>
                        <span>ç›´é€²ã¨ã‚«ãƒ¼ãƒ–ã‚’åˆ†ã‘ã¦å…¥åŠ›ã™ã‚‹ã¨ã€ã‚ˆã‚Šå®Ÿéš›ã«è¿‘ã„å¹³å‡é€Ÿåº¦ãŒç®—å‡ºã•ã‚Œã¾ã™ã€‚æœªå…¥åŠ›ã®å ´åˆã¯ç‰‡é“è·é›¢ãŒç›´é€²ã¨ã—ã¦ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚</span>
                    </div>
                    <div class="segment-list" id="segmentList">
                        <!-- Dynamic segments -->
                    </div>
                    <div style="display:flex;gap:8px;margin-top:10px;">
                        <button class="btn btn-ghost" onclick="addSegment('straight')">ï¼‹ ç›´é€²åŒºé–“ã‚’è¿½åŠ </button>
                        <button class="btn btn-ghost" onclick="addSegment('curve')">ï¼‹ ã‚«ãƒ¼ãƒ–åŒºé–“ã‚’è¿½åŠ </button>
                    </div>
                    <div class="form-group mt-12">
                        <label class="form-label">ã‚«ãƒ¼ãƒ–æ™‚ã®é€Ÿåº¦ä½ä¸‹ç‡ <span class="form-unit">%ï¼ˆã‚«ã‚¿ãƒ­ã‚°é€Ÿåº¦ã«å¯¾ã—ã¦ï¼‰</span></label>
                        <input type="number" class="form-input" id="curveSpeedRate" value="50" min="10" max="100" step="5" oninput="calculate()">
                    </div>
                    <div class="form-group mt-8" id="segmentSummary" style="display:none;">
                        <div class="result-grid">
                            <div class="result-item">
                                <span class="result-label">çµŒè·¯åˆè¨ˆè·é›¢</span>
                                <span class="result-value" id="segTotalDist">-</span>
                            </div>
                            <div class="result-item">
                                <span class="result-label">çµŒè·¯ãƒ™ãƒ¼ã‚¹å¹³å‡é€Ÿåº¦</span>
                                <span class="result-value" id="segAvgSpeed">-</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ===== å³ã‚«ãƒ©ãƒ : çµæœ ===== -->
        <div>
            <!-- è¨ˆç®—çµæœ -->
            <div class="card mb-8">
                <div class="card-header">
                    <div class="card-header-icon green">â– </div>
                    <span class="card-title">è¨ˆç®—çµæœ</span>
                </div>
                <div class="card-body">
                    <div class="result-grid">
                        <div class="result-item">
                            <span class="result-label">å¾€å¾©è·é›¢</span>
                            <span class="result-value"><span id="resRoundTrip">100</span><span class="result-unit">m</span></span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">å¹³å‡æœ€é«˜é€Ÿåº¦</span>
                            <span class="result-value"><span id="resMaxSpeed">4.00</span><span class="result-unit">km/h</span></span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">ç†è«–å¾€å¾©èµ°è¡Œæ™‚é–“</span>
                            <span class="result-value"><span id="resTheoTime">1.50</span><span class="result-unit">åˆ†</span></span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">èµ°è¡Œåœæ­¢ãƒ­ã‚¹æ™‚é–“</span>
                            <span class="result-value"><span id="resStopLoss">1.00</span><span class="result-unit">åˆ†</span></span>
                        </div>
                        <div class="result-item" id="resLiftRow">
                            <span class="result-label">ãƒªãƒ•ãƒˆå‹•ä½œãƒ­ã‚¹æ™‚é–“</span>
                            <span class="result-value"><span id="resLiftLoss">1.00</span><span class="result-unit">åˆ†</span></span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">å¾è¡Œãƒ»æ¸›é€Ÿãƒ­ã‚¹æ™‚é–“</span>
                            <span class="result-value"><span id="resSlowLoss">0.38</span><span class="result-unit">åˆ†</span></span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">å¾€å¾©æ‰€è¦æ™‚é–“</span>
                            <span class="result-value highlight"><span id="resRoundTime">3.88</span><span class="result-unit">åˆ†/å›</span></span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">å¹³å‡é€Ÿåº¦</span>
                            <span class="result-value"><span id="resAvgSpeedKm">1.55</span><span class="result-unit">km/h</span></span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">å¹³å‡é€Ÿåº¦</span>
                            <span class="result-value"><span id="resAvgSpeedM">25.81</span><span class="result-unit">m/min</span></span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">å‡¦ç†èƒ½åŠ›</span>
                            <span class="result-value highlight"><span id="resCapacity">15.48</span><span class="result-unit">å¾€å¾©/æ™‚</span></span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- å¿…è¦å°æ•° -->
            <div class="card mb-8" style="margin-top:16px;">
                <div class="card-header">
                    <div class="card-header-icon red">â˜…</div>
                    <span class="card-title">å¿…è¦å°æ•°</span>
                </div>
                <div class="card-body">
                    <div class="result-grid mb-8">
                        <div class="result-item">
                            <span class="result-label">å¿…è¦å‡¦ç†èƒ½åŠ›ï¼ˆ1hã‚ãŸã‚Šã®å¸Œæœ›æ¬é€å›æ•°ï¼‰</span>
                            <span class="result-value"><span id="resRequiredCap">7.69</span><span class="result-unit">å›/h</span></span>
                        </div>
                        <div class="result-item">
                            <span class="result-label" id="resRobotCapLabel">AGFå‡¦ç†èƒ½åŠ›</span>
                            <span class="result-value success"><span id="resRobotCap">15.48</span><span class="result-unit">å›/h</span></span>
                        </div>
                    </div>

                    <div class="big-number-grid mt-16">
                        <div class="big-number primary">
                            <div class="big-number-label">æ¨™æº– (Ã—1.1)</div>
                            <div class="big-number-value" id="resUnitsStd">1</div>
                            <div class="big-number-unit">å°</div>
                        </div>
                        <div class="big-number warning">
                            <div class="big-number-label">äººæ··åœ¨ (Ã—1.2)</div>
                            <div class="big-number-value" id="resUnitsMixed">1</div>
                            <div class="big-number-unit">å°</div>
                        </div>
                        <div class="big-number success">
                            <div class="big-number-label">å°†æ¥å¢—è¨­ (Ã—1.3)</div>
                            <div class="big-number-value" id="resUnitsFuture">1</div>
                            <div class="big-number-unit">å°</div>
                        </div>
                    </div>

                    <div class="form-group mt-16">
                        <label class="form-label">ã‚«ã‚¹ã‚¿ãƒ ä½™è£•ç‡ <span class="form-unit">ï¼ˆä»»æ„å…¥åŠ›ï¼‰</span></label>
                        <div class="form-row">
                            <input type="number" class="form-input" id="customMargin" value="" placeholder="ä¾‹: 1.15" min="1.0" max="3.0" step="0.05" oninput="calculate()">
                            <div style="display:flex;align-items:center;">
                                <span class="result-value highlight" id="resUnitsCustom" style="min-width:40px;">-</span>
                                <span class="result-unit">å°</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ä½™è£•ç‡ å‚è€ƒãƒ†ãƒ¼ãƒ–ãƒ« -->
            <div class="card mb-8" style="margin-top:16px;">
                <div class="card-header">
                    <div class="card-header-icon orange">ğŸ“‹</div>
                    <span class="card-title">ä½™è£•ç‡ å‚è€ƒç›®å®‰</span>
                </div>
                <div class="card-body">
                    <table class="ref-table">
                        <thead>
                            <tr><th>ç¾å ´æ¡ä»¶</th><th>ä½™è£•ç‡</th></tr>
                        </thead>
                        <tbody>
                            <tr><td>ç„¡äººãƒ»ç›´ç·šä¸­å¿ƒ</td><td>Ã—1.05</td></tr>
                            <tr><td>ä¸€èˆ¬å·¥å ´</td><td>Ã—1.10</td></tr>
                            <tr><td>äººæ··åœ¨ãƒ»äº¤å·®å¤š</td><td>Ã—1.20</td></tr>
                            <tr><td>ä¸ç¢ºå®šè¦ç´ å¤š</td><td>Ã—1.30</td></tr>
                        </tbody>
                    </table>
                    <div class="info-banner warn mt-12">
                        <span>âš ï¸</span>
                        <span>å‡¦ç†èƒ½åŠ›ã¯ã‚ãã¾ã§å¹³å‡å€¤ã‹ã‚‰ã®ç®—å‡ºã§ã™ã€‚ç¾å ´ã§ã¯æ§˜ã€…ãªãƒˆãƒ©ãƒ–ãƒ«ãŒã‚ã‚Šã€å¹³å‡å€¤ã®ã¿ã§ã¯ç ´ç¶»ã—ã‚„ã™ã„ãŸã‚ã€ä½™è£•ç‡ã‚’é©åˆ‡ã«è¨­å®šã—ã¦ãã ã•ã„ã€‚</span>
                    </div>
                </div>
            </div>

            <!-- è¤‡æ•°åœ°ç‚¹æ¬é€ -->
            <div class="card" style="margin-top:16px;">
                <div class="card-header">
                    <div class="card-header-icon blue">ğŸ“</div>
                    <span class="card-title">è¤‡æ•°åœ°ç‚¹æ¬é€ï¼ˆå¹³å‡è·é›¢ç®—å‡ºï¼‰</span>
                </div>
                <div class="card-body">
                    <div class="info-banner info mb-8">
                        <span>ğŸ’¡</span>
                        <span>ãƒ”ãƒƒã‚¯ã‚¢ãƒƒãƒ—ç®‡æ‰€ã‚„é™ã‚ã™å ´æ‰€ãŒè¤‡æ•°ã‚ã‚‹å ´åˆã€å„ãƒ«ãƒ¼ãƒˆã®è·é›¢ã‚’å…¥åŠ›ã™ã‚‹ã¨å¹³å‡ç§»å‹•è·é›¢ã¨å¿…è¦å°æ•°ã‚’ç®—å‡ºã—ã¾ã™ã€‚</span>
                    </div>
                    <div class="route-list" id="routeList">
                        <!-- Dynamic routes -->
                    </div>
                    <button class="btn btn-ghost mt-8" onclick="addRoute()">ï¼‹ ãƒ«ãƒ¼ãƒˆã‚’è¿½åŠ </button>

                    <div id="multiRouteResult" style="display:none;" class="mt-16">
                        <div class="separator"></div>
                        <div class="result-grid">
                            <div class="result-item">
                                <span class="result-label">å¹³å‡ç‰‡é“è·é›¢</span>
                                <span class="result-value"><span id="resAvgDist">-</span><span class="result-unit">m</span></span>
                            </div>
                            <div class="result-item">
                                <span class="result-label">å¹³å‡å¾€å¾©æ‰€è¦æ™‚é–“</span>
                                <span class="result-value"><span id="resAvgRoundTime">-</span><span class="result-unit">åˆ†/å›</span></span>
                            </div>
                            <div class="result-item">
                                <span class="result-label">å¹³å‡å‡¦ç†èƒ½åŠ›</span>
                                <span class="result-value success"><span id="resAvgCapacity">-</span><span class="result-unit">å¾€å¾©/æ™‚</span></span>
                            </div>
                        </div>

                        <div class="big-number-grid mt-12">
                            <div class="big-number primary">
                                <div class="big-number-label">æ¨™æº– (Ã—1.1)</div>
                                <div class="big-number-value" id="resMultiStd">-</div>
                                <div class="big-number-unit">å°</div>
                            </div>
                            <div class="big-number warning">
                                <div class="big-number-label">äººæ··åœ¨ (Ã—1.2)</div>
                                <div class="big-number-value" id="resMultiMixed">-</div>
                                <div class="big-number-unit">å°</div>
                            </div>
                            <div class="big-number success">
                                <div class="big-number-label">å°†æ¥å¢—è¨­ (Ã—1.3)</div>
                                <div class="big-number-value" id="resMultiFuture">-</div>
                                <div class="big-number-unit">å°</div>
                            </div>
                        </div>

                        <div class="separator"></div>
                        <div class="result-grid">
                            <div class="result-item">
                                <span class="result-label">å¹³å‡å¾€å¾©æ‰€è¦æ™‚é–“ï¼ˆãƒ­ã‚¹è¾¼ã¿ï¼‰</span>
                                <span class="result-value"><span id="resAvgTimeMin">-</span><span class="result-unit">åˆ†</span></span>
                            </div>
                            <div class="result-item">
                                <span class="result-label">å¹³å‡å¾€å¾©æ‰€è¦æ™‚é–“ï¼ˆãƒ­ã‚¹è¾¼ã¿ï¼‰</span>
                                <span class="result-value"><span id="resAvgTimeHour">-</span><span class="result-unit">æ™‚é–“</span></span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // ====== State ======
    let currentMode = 'agf'; // 'agf' or 'agv'
    let segments = []; // { type: 'straight'|'curve', distance: number }
    let routes = []; // { name: string, distance: number }
    let routeCounter = 0;
    let tripMode = 'auto'; // 'auto' or 'manual'

    // ====== Trip Mode Switch ======
    function setTripMode(mode) {
        tripMode = mode;
        document.getElementById('tripModeAuto').classList.toggle('active', mode === 'auto');
        document.getElementById('tripModeManual').classList.toggle('active', mode === 'manual');
        document.getElementById('tripAutoSection').classList.toggle('hidden', mode !== 'auto');
        document.getElementById('tripManualSection').classList.toggle('hidden', mode !== 'manual');
        calculate();
    }

    // ====== Mode Switch ======
    function switchMode(mode) {
        currentMode = mode;
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        event.target.classList.add('active');

        const isAGF = mode === 'agf';
        document.getElementById('pageTitle').textContent = isAGF
            ? 'AGF èƒ½åŠ›è¨ˆç®—ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼'
            : 'AGV èƒ½åŠ›è¨ˆç®—ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼';
        document.getElementById('specTitle').textContent = isAGF
            ? 'AGF ã‚¹ãƒšãƒƒã‚¯ãƒ»èµ°è¡Œæ¡ä»¶'
            : 'AGV ã‚¹ãƒšãƒƒã‚¯ãƒ»èµ°è¡Œæ¡ä»¶';
        document.getElementById('liftSection').classList.toggle('hidden', !isAGF);
        document.getElementById('resLiftRow').classList.toggle('hidden', !isAGF);
        document.getElementById('resRobotCapLabel').textContent = isAGF ? 'AGFå‡¦ç†èƒ½åŠ›' : 'AGVå‡¦ç†èƒ½åŠ›';

        // Default values per mode
        if (isAGF) {
            document.getElementById('catalogSpeed').value = 5;
            document.getElementById('opCoeff').value = 0.8;
        } else {
            document.getElementById('catalogSpeed').value = 3;
            document.getElementById('opCoeff').value = 0.9;
        }
        calculate();
    }

    // ====== Segments ======
    function addSegment(type) {
        segments.push({ type, distance: type === 'straight' ? 20 : 5 });
        renderSegments();
        calculate();
    }

    function removeSegment(idx) {
        segments.splice(idx, 1);
        renderSegments();
        calculate();
    }

    function updateSegment(idx, val) {
        segments[idx].distance = parseFloat(val) || 0;
        calculate();
    }

    function renderSegments() {
        const list = document.getElementById('segmentList');
        if (segments.length === 0) {
            list.innerHTML = '<div class="text-xs text-muted" style="padding:8px 0;">çµŒè·¯åŒºé–“ãŒæœªå…¥åŠ›ã§ã™ã€‚ç‰‡é“è·é›¢ãŒãã®ã¾ã¾ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚</div>';
            document.getElementById('segmentSummary').style.display = 'none';
            return;
        }
        document.getElementById('segmentSummary').style.display = 'block';
        list.innerHTML = segments.map((s, i) => `
            <div class="segment-item">
                <span class="segment-type ${s.type}">${s.type === 'straight' ? 'ç›´é€²' : 'ã‚«ãƒ¼ãƒ–'}</span>
                <span style="font-size:12px;">åŒºé–“ ${i + 1}</span>
                <input type="number" class="form-input form-input-sm route-input"
                    value="${s.distance}" min="0" step="1"
                    oninput="updateSegment(${i}, this.value)">
                <span class="form-unit">m</span>
                <button class="route-btn-remove" onclick="removeSegment(${i})">Ã—</button>
            </div>
        `).join('');
    }

    // ====== Routes ======
    function addRoute() {
        routeCounter++;
        routes.push({ name: `ãƒ«ãƒ¼ãƒˆ ${routeCounter}`, distance: 50 });
        renderRoutes();
        calculate();
    }

    function removeRoute(idx) {
        routes.splice(idx, 1);
        renderRoutes();
        calculate();
    }

    function updateRouteDist(idx, val) {
        routes[idx].distance = parseFloat(val) || 0;
        calculate();
    }

    function updateRouteName(idx, val) {
        routes[idx].name = val;
    }

    function renderRoutes() {
        const list = document.getElementById('routeList');
        if (routes.length === 0) {
            list.innerHTML = '<div class="text-xs text-muted" style="padding:8px 0;">ãƒ«ãƒ¼ãƒˆãŒæœªç™»éŒ²ã§ã™ã€‚ä¸Šã®åŸºæœ¬æ¬é€æ¡ä»¶ã®è¨ˆç®—ã®ã¿è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</div>';
            document.getElementById('multiRouteResult').style.display = 'none';
            return;
        }
        document.getElementById('multiRouteResult').style.display = 'block';
        list.innerHTML = routes.map((r, i) => `
            <div class="route-item">
                <span class="route-badge">R${i + 1}</span>
                <input type="text" class="form-input form-input-sm" value="${r.name}"
                    onchange="updateRouteName(${i}, this.value)" style="max-width:140px;">
                <input type="number" class="form-input form-input-sm route-input"
                    value="${r.distance}" min="0" step="1"
                    oninput="updateRouteDist(${i}, this.value)">
                <span class="form-unit">mï¼ˆç‰‡é“ï¼‰</span>
                <button class="route-btn-remove" onclick="removeRoute(${i})">Ã—</button>
            </div>
        `).join('');
    }

    // ====== Core Calculation ======
    function calculate() {
        const isAGF = currentMode === 'agf';

        // --- Basic Inputs ---
        const oneWayDist = parseFloat(document.getElementById('oneWayDist').value) || 0;
        const opHours = parseFloat(document.getElementById('opHours').value) || 1;
        const dailyTrips = parseFloat(document.getElementById('dailyTrips').value) || 0;
        const catalogSpeed = parseFloat(document.getElementById('catalogSpeed').value) || 1;
        const opCoeff = parseFloat(document.getElementById('opCoeff').value) || 1;
        const stopCount = parseFloat(document.getElementById('stopCount').value) || 0;
        const stopLoss = parseFloat(document.getElementById('stopLoss').value) || 0;
        const slowdownRate = parseFloat(document.getElementById('slowdownRate').value) || 0;

        // AGF-specific
        const liftUp = isAGF ? (parseFloat(document.getElementById('liftUp').value) || 0) : 0;
        const liftDown = isAGF ? (parseFloat(document.getElementById('liftDown').value) || 0) : 0;
        const liftCycles = isAGF ? (parseFloat(document.getElementById('liftCycles').value) || 0) : 0;

        // --- Derived ---
        const roundTrip = oneWayDist * 2;
        let hourlyTrips;
        if (tripMode === 'auto') {
            hourlyTrips = dailyTrips / opHours;
            document.getElementById('hourlyTrips').value = hourlyTrips.toFixed(2);
        } else {
            hourlyTrips = parseFloat(document.getElementById('hourlyTripsManual').value) || 0;
        }
        const maxSpeed = catalogSpeed * opCoeff; // km/h

        document.getElementById('roundTripDist').value = roundTrip;

        // --- Segment-based speed calculation ---
        let effectiveMaxSpeedKmh = maxSpeed;
        if (segments.length > 0) {
            const curveSpeedRate = (parseFloat(document.getElementById('curveSpeedRate').value) || 50) / 100;
            const straightSpeed = maxSpeed; // km/h
            const curveSpeed = maxSpeed * curveSpeedRate;

            let totalDist = 0;
            let totalTime = 0; // hours
            segments.forEach(s => {
                totalDist += s.distance;
                if (s.type === 'straight') {
                    totalTime += (s.distance / 1000) / straightSpeed; // hours
                } else {
                    totalTime += (s.distance / 1000) / curveSpeed; // hours
                }
            });

            if (totalTime > 0 && totalDist > 0) {
                effectiveMaxSpeedKmh = (totalDist / 1000) / totalTime; // km/h
                document.getElementById('segTotalDist').innerHTML = totalDist.toFixed(1) + '<span class="result-unit">m</span>';
                document.getElementById('segAvgSpeed').innerHTML = effectiveMaxSpeedKmh.toFixed(2) + '<span class="result-unit">km/h</span>';
            }
        }

        // --- Core Formulas (matching Excel) ---
        // å¾€å¾©è·é›¢
        const G15 = roundTrip;
        // ç†è«–å¾€å¾©èµ°è¡Œæ™‚é–“ (åˆ†) = å¾€å¾©è·é›¢ / (æœ€é«˜é€Ÿåº¦*1000) * 60
        const G16 = G15 / (effectiveMaxSpeedKmh * 1000) * 60;
        // èµ°è¡Œåœæ­¢ãƒ­ã‚¹æ™‚é–“ (åˆ†) = ç‰‡é“åœæ­¢å›æ•° * 2 * åœæ­¢ãƒ­ã‚¹ç§’ / 60
        const G17 = stopCount * 2 * stopLoss / 60;
        // ãƒªãƒ•ãƒˆå‹•ä½œãƒ­ã‚¹æ™‚é–“ (åˆ†) = (ä¸Šæ˜‡+ä¸‹é™) * å›æ•° / 60
        const G18 = isAGF ? (liftUp + liftDown) * liftCycles / 60 : 0;
        // å¾è¡Œãƒ»æ¸›é€Ÿãƒ­ã‚¹æ™‚é–“ (åˆ†) = ç†è«–å¾€å¾©èµ°è¡Œæ™‚é–“ * (ãƒ­ã‚¹ç‡/100)
        const G19 = G16 * (slowdownRate / 100);
        // å¾€å¾©æ‰€è¦æ™‚é–“ (åˆ†/å›) = ç†è«–èµ°è¡Œ + åœæ­¢ãƒ­ã‚¹ + ãƒªãƒ•ãƒˆãƒ­ã‚¹ + å¾è¡Œãƒ­ã‚¹
        const G20 = G16 + G17 + G18 + G19;
        // å¹³å‡é€Ÿåº¦ (km/h)
        const G21 = G15 / (G20 / 60) / 1000;
        // å¹³å‡é€Ÿåº¦ (m/min)
        const G22 = G21 * 1000 / 60;
        // å‡¦ç†èƒ½åŠ› (å¾€å¾©/æ™‚)
        const G23 = 60 / G20;

        // å¿…è¦å°æ•°
        const requiredCap = hourlyTrips;
        const robotCap = G23;
        const unitsStd = Math.ceil(requiredCap / robotCap * 1.1);
        const unitsMixed = Math.ceil(requiredCap / robotCap * 1.2);
        const unitsFuture = Math.ceil(requiredCap / robotCap * 1.3);

        // Custom margin
        const customMarginVal = parseFloat(document.getElementById('customMargin').value);
        const unitsCustom = customMarginVal ? Math.ceil(requiredCap / robotCap * customMarginVal) : null;

        // --- Update DOM ---
        document.getElementById('resRoundTrip').textContent = roundTrip.toFixed(0);
        document.getElementById('resMaxSpeed').textContent = effectiveMaxSpeedKmh.toFixed(2);
        document.getElementById('resTheoTime').textContent = G16.toFixed(2);
        document.getElementById('resStopLoss').textContent = G17.toFixed(2);
        if (isAGF) document.getElementById('resLiftLoss').textContent = G18.toFixed(2);
        document.getElementById('resSlowLoss').textContent = G19.toFixed(2);
        document.getElementById('resRoundTime').textContent = G20.toFixed(2);
        document.getElementById('resAvgSpeedKm').textContent = G21.toFixed(2);
        document.getElementById('resAvgSpeedM').textContent = G22.toFixed(2);
        document.getElementById('resCapacity').textContent = G23.toFixed(2);
        document.getElementById('resRequiredCap').textContent = requiredCap.toFixed(2);
        document.getElementById('resRobotCap').textContent = robotCap.toFixed(2);
        document.getElementById('resUnitsStd').textContent = Math.max(unitsStd, 1);
        document.getElementById('resUnitsMixed').textContent = Math.max(unitsMixed, 1);
        document.getElementById('resUnitsFuture').textContent = Math.max(unitsFuture, 1);
        document.getElementById('resUnitsCustom').textContent = unitsCustom !== null ? Math.max(unitsCustom, 1) : '-';

        // --- Multi-route calculation ---
        if (routes.length > 0) {
            const validRoutes = routes.filter(r => r.distance > 0);
            if (validRoutes.length > 0) {
                const avgDist = validRoutes.reduce((sum, r) => sum + r.distance, 0) / validRoutes.length;
                const avgRoundTrip = avgDist * 2;

                // Recalculate with average distance
                const avgG16 = avgRoundTrip / (effectiveMaxSpeedKmh * 1000) * 60;
                const avgG17 = stopCount * 2 * stopLoss / 60;
                const avgG18 = isAGF ? (liftUp + liftDown) * liftCycles / 60 : 0;
                const avgG19 = avgG16 * (slowdownRate / 100);
                const avgG20 = avgG16 + avgG17 + avgG18 + avgG19;
                const avgCap = 60 / avgG20;

                const multiStd = Math.ceil(requiredCap / avgCap * 1.1);
                const multiMixed = Math.ceil(requiredCap / avgCap * 1.2);
                const multiFuture = Math.ceil(requiredCap / avgCap * 1.3);

                document.getElementById('resAvgDist').textContent = avgDist.toFixed(1);
                document.getElementById('resAvgRoundTime').textContent = avgG20.toFixed(2);
                document.getElementById('resAvgCapacity').textContent = avgCap.toFixed(2);
                document.getElementById('resMultiStd').textContent = Math.max(multiStd, 1);
                document.getElementById('resMultiMixed').textContent = Math.max(multiMixed, 1);
                document.getElementById('resMultiFuture').textContent = Math.max(multiFuture, 1);
                document.getElementById('resAvgTimeMin').textContent = avgG20.toFixed(2);
                document.getElementById('resAvgTimeHour').textContent = (avgG20 / 60).toFixed(4);
            }
        }
    }

    // ====== Init ======
    renderSegments();
    renderRoutes();
    calculate();
</script>

</body>
</html>
